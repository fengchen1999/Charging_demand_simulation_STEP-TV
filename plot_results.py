import matplotlib.pyplot as plt
import pandas as pd
import numpy as np
from mpl_toolkits.mplot3d import Axes3D
import matplotlib as mpl
mpl.rcParams['font.size'] = 12


def charging_demand_between(Days_T_S_demand):
    mpl.rcParams['font.size'] = 20
    # <editor-fold desc="plot conventional loads v.s. EV cahrging loads">
    high = np.max(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    low = np.min(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    mean = np.average(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    fig, ax = plt.subplots()
    tt = np.arange(0, 24) + 0.5
    ax.plot(tt, mean, 'r')

    ax.fill_between(tt, high, low, alpha=0.3, color='royalblue')

    plt.xlabel('Time (hour)')
    plt.ylabel('Charging loads (MWh)')
    plt.legend(['Charging loads'], fontsize=20, loc='upper left')
    plt.grid()
    # df = pd.DataFrame(Days_T_S_demand.sum(axis=-1)) / 1000
    # df.plot.box()
    plt.show()
    fig.savefig('./results_ChargeModel/charging_demand_between.pdf', dpi=600, bbox_inches='tight', pad_inches=0)
    mpl.rcParams['font.size'] = 12
    # </editor-fold>

def traffic_flow_between(Days_T_S_traffic_flow):
    mpl.rcParams['font.size'] = 20
    # <editor-fold desc="plot conventional loads v.s. EV cahrging loads">
    high = np.max(Days_T_S_traffic_flow.sum(axis=-1), axis=0)
    low = np.min(Days_T_S_traffic_flow.sum(axis=-1), axis=0)
    mean = np.average(Days_T_S_traffic_flow.sum(axis=-1), axis=0)
    fig, ax = plt.subplots()
    tt = np.arange(0.5, 24 + 0.5)
    ax.plot(tt, mean, 'b')

    ax.fill_between(tt, high, low, alpha=0.3, color='royalblue')

    plt.xlabel('Time (hour)')
    plt.ylabel('Traffic flow (vehicles per hour)')
    plt.legend(['Average traffic flow'], fontsize=20, loc='upper left')
    plt.grid(alpha=0.4)
    # df = pd.DataFrame(Days_T_S_demand.sum(axis=-1)) / 1000
    # df.plot.box()
    plt.xticks(np.arange(0, 24 + 1, 2))
    plt.show()
    fig.savefig('./results_ChargeModel/traffic_flow_between.pdf', dpi=600, bbox_inches='tight', pad_inches=0)
    mpl.rcParams['font.size'] = 12
    # </editor-fold>


def charging_demand_between_vsEVI(Days_T_S_demand):
    import matplotlib as mpl
    mpl.rcParams['font.size'] = 20
    # <editor-fold desc="plot conventional loads v.s. EV cahrging loads">
    EVI_Weekday_L2 = np.array(
        [2428.84,2148.25,1908.59,1780.78,1614.16,1439.42,1265.13,1219.07,1044.22,820.61,674.87,552.96,544.27,513.65,430.64,409.33,381.13,391.07,408.84,474.52,509.93,639.08,1055.76,1219.74,1602.06,1778.46,2182.79,2651.67,3518.8,3982.59,4487.6,4880.22,5915.31,6597.94,7315.98,7611.28,8437.83,9030.73,9399.94,9850.27,10405.12,10349.91,10589.68,10694.09,11320.05,11445.65,11413.81,11183.52,11172.03,10926.68,11165.06,10836.64,10967.85,11105.11,11548.34,11712.64,11886.27,11541.45,10732.14,10508.3,10883.04,10912.61,10401.43,10341.91,10171.63,10135.2,10217.88,10483.76,10970.61,10936.5,11492.52,11999.22,12354.76,12867.83,13089.29,13482.83,14146.27,14236.29,14037.65,13617.56,12326.47,11088.62,9704.73,8662.63,7317.61,6337.43,5540.84,5075.07,4815.79,4421.25,3996.34,3761.36,3274.78,2976.16,2897.78,2768.51])
    EVI_Weekday_L3 = np.array(
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.03,79.46,273.27,422.33,421.31,319.15,186.97,413.75,545.6,449.83,518.04,1081.49,551.91,652.71,682.28,705.36,910.28,798.02,612.94,1195.09,1146.56,1159.67,1120.1,1026.25,875.56,1471.87,1389.56,2029.22,1734.09,1127.17,594.97,539.29,616.46,893.59,789.5,714.81,939.35,1142.35,1099.29,785.87,760.6,566.3,707.17,739.96,609.65,1276.49,1367.58,1318.56,981.48,540.54,831.78,811.02,1131.44,987.67,850.53,413.87,238.44,183.49,0,0,178.75,178.81,35.35,0.03,126.76,60.71,0,154.99,178.81,178.81,178.81])
    EVI_Weekend_L2 = np.array(
        [4639.43,4368.05,3821.22,3161.62,2677.48,2332.11,1967.52,1682.83,1551.74,1493.68,1263.29,1407.79,1372,1121.99,837.01,750.57,684.55,618.99,654.46,612.12,579.15,595.14,698.12,834.1,1109.61,1147.7,1392.88,1622.36,2353.54,2702.4,3830.76,4469.37,6333.13,6835.33,8085.65,8931.79,10404.6,10916.15,12316.24,12705.77,14922.17,15383.26,15995.9,16896.01,18018.2,18623.61,19375.23,20155.14,20748.83,21277.28,21464.87,21436.26,22565.06,23210.3,22991.46,23410.68,22883.77,21768.11,21050.68,21329.73,21128.51,20931.1,20042.1,18794.83,18113.83,18605.62,19262.75,19041.43,19565.41,19729.33,19323.57,20034.28,20018.2,20856.84,21112.7,21108.28,20231.7,19849.26,19998.87,18888.59,17129.15,15796.4,14777.7,13498.83,11757.99,10666.47,10059.92,8991.72,7671.84,7333.16,7010.85,6811.81,6232.74,5878.15,5456.81,5024.95])
    EVI_Weekend_L3 = np.array(
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,335.43,427.42,79.08,0,0,0,0,0,0,0,11.95,174.82,324.18,391.89,1181.57,1324.87,1380.17,1506.88,2261.2,1783.92,1342.29,1604.13,2021.37,2596.69,4117.17,3608.23,3061.81,2716.12,2512.23,3173.22,3794.68,3361.39,2398.17,2562.47,2799.27,2491.15,2434.25,1992.56,2391.66,2150.08,2809.94,2585.73,3325.46,4163.63,2792.56,1598.84,1205.15,2146.65,2922.26,2789.71,2641.11,2362.09,1791.42,1739.93,1664.14,1328.8,1377.18,1242.77,1499.03,1163.92,1041.23,912.57,817.53,866.35,410.73,733.36,474.46,209.19,277.05,277.05,100.45,59.6,59.6,59.6,59.6,59.6,187.7,154.09])

    EVI_load = ((EVI_Weekday_L2 + EVI_Weekday_L3) * 5 / 7 + (EVI_Weekend_L2 + EVI_Weekend_L3) * 2 / 7) / 1000 / 10 # kWh --> MWh, 145000 --> 14500 EVs
    EVI_load_weekday = (EVI_Weekday_L2 + EVI_Weekday_L3) / 1000 / 10
    EVI_load_weekend = (EVI_Weekend_L2 + EVI_Weekend_L3) / 1000 / 10


    high = np.max(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    low = np.min(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    mean = np.average(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    fig, ax = plt.subplots()
    tt = np.arange(0.5, 24 + 0.5)
    ax.plot(tt, mean, 'r')
    tt1 = np.arange(0, 24, 0.25)
    ax.plot(tt1, EVI_load)
    # ax.plot(tt1, EVI_load_weekday)
    # ax.plot(tt1, EVI_load_weekend)
    print('Our loads: ', sum(mean), 'MWh')
    print('EVI loads: ', sum(EVI_load)/4, 'MWh') # step,0.25h

    ax.fill_between(tt, high, low, alpha=0.3, color='royalblue')

    plt.xlabel('Time (hour)')
    plt.ylabel('Charging loads (MWh)')
    plt.legend(['Average in simulations', 'Average in EVI-Pro'], fontsize=20, loc='upper left')
    # plt.legend(['Simulation results', 'Average in EVI', 'Weekday in EVI', 'Weekday in EVI'], fontsize=12, loc='upper left')
    plt.grid(alpha=0.4)
    # df = pd.DataFrame(Days_T_S_demand.sum(axis=-1)) / 1000
    # df.plot.box()
    plt.xticks(np.arange(0, 24 + 1, 2))
    plt.show()
    fig.savefig('./results_ChargeModel/charging_demand_between_vsEVI.pdf', dpi=600, bbox_inches='tight', pad_inches=0)
    mpl.rcParams['font.size'] = 12
    # </editor-fold>


def charging_demand_between_vsEVI_temperatures(Days_T_S_demand):
    import matplotlib as mpl
    mpl.rcParams['font.size'] = 20
    # <editor-fold desc="plot conventional loads v.s. EV cahrging loads">
    EVI_Weekday_L2 = np.array(
        [[3980.03,3565.43,3135.46,2919.12,2588.72,2297.46,2097.83,2079.05,1913.33,1672.98,1427.33,1226.25,1168.19,976.54,866.55,806.66,828.55,851.05,851,828.64,940.37,1193.84,1438.64,1718.94,2402.38,2571.01,2971.45,3617.77,4423.41,4905.37,6054.11,7386.13,9203.08,10127.06,11619.37,12455.88,13163.43,13995.73,14795.53,15019.83,16363.86,16539.41,16309.53,16636.06,17012.97,17155.93,17269.61,17479.81,17745.49,17705.28,17386.72,17716.5,17643.85,17452.54,17688.3,17737.52,17835.39,17511.88,16549.53,16059.63,16205.7,16243.88,15515.51,15728.8,15945.4,16170,14953.72,14713.36,15291.41,16175.67,17428.87,18185.67,19588.87,20551.6,21032.19,21118.89,21644.87,21461.87,21025.79,20244.58,18184.59,16831.52,14489.12,12942.23,11072.57,9906.99,8674.05,7725.54,7027.83,6173.49,5682.66,5371.71,4949.18,4546.82,4396.08,4289.11],
         [3428.12,2945.17,2520.13,2341.5,2154.5,1895.89,1636.87,1584.18,1449.43,1339.21,1205.06,1057.48,958.05,815.23,731.94,720.57,733.91,683.68,656.49,813.08,995.46,1127.02,1443.03,1675.36,2311.15,2462.6,2883.91,3601.75,4220.7,4731.12,5875.13,6952.67,8294.67,8806.54,9755.72,10566.28,12119.15,12819.31,13641.08,14156.28,14420.62,14160.9,14453.38,14637.04,15154.1,15140.72,15130.23,15563.05,15829.43,16057.02,15812.97,15632.74,16062.86,15964.01,16321.5,16451.03,15906.41,15331.65,15320.14,14786.08,14812.59,14673.56,14144.21,14605.59,14681.29,14653.09,14169.91,14427.94,14935.11,15226.32,15663.68,16538.22,17502.72,18238.38,18818.99,19529.91,20144.88,19852.08,19040.74,18166.6,16794.33,15289.87,13589.83,12028.7,10294.46,9255.3,7922.9,7000.44,6429.6,5864.49,5447.19,5070.62,4665.88,4281.12,4092.08,3877.8],
         [3379.79,3008.87,2626.86,2366.77,2148.19,1876.49,1583.02,1444.86,1405.58,1249.46,1061.7,963.22,890.36,785.38,664.2,625.41,593.98,531.04,546.56,603.49,800.17,1067.13,1432.36,1520.13,2094.23,2378.83,2870.77,3518.71,4136.59,4723.1,5451.49,6038.2,7307.78,8372.56,9592.79,10032.25,11169.21,11434.37,11850.45,12142.79,12518.92,12487.92,12475.36,12881.9,13201.54,13192.39,13295.37,13436.64,13562.12,13895.54,13911.97,13538.95,13593.96,13852.77,13851.49,14126.01,14442.65,13993.49,13708.77,12811.57,12523.36,12472.51,12573.23,12465.04,13045.65,13130.34,12616.6,12688.71,12875.16,13300.31,14473.33,15561.42,16551.28,17317.46,17800.24,18368.17,18829.02,18289.87,17562.18,16893.8,15510.95,14171.48,12262.48,10901.01,9381.6,7992.01,6879.61,6161.83,5991.89,5656.81,5109.09,4801.63,4291.26,3945.34,3816.86,3675.07],
         [2428.84,2148.25,1908.59,1780.78,1614.16,1439.42,1265.13,1219.07,1044.22,820.61,674.87,552.96,544.27,513.65,430.64,409.33,381.13,391.07,408.84,474.52,509.93,639.08,1055.76,1219.74,1602.06,1778.46,2182.79,2651.67,3518.8,3982.59,4487.6,4880.22,5915.31,6597.94,7315.98,7611.28,8437.83,9030.73,9399.94,9850.27,10405.12,10349.91,10589.68,10694.09,11320.05,11445.65,11413.81,11183.52,11172.03,10926.68,11165.06,10836.64,10967.85,11105.11,11548.34,11712.64,11886.27,11541.45,10732.14,10508.3,10883.04,10912.61,10401.43,10341.91,10171.63,10135.2,10217.88,10483.76,10970.61,10936.5,11492.52,11999.22,12354.76,12867.83,13089.29,13482.83,14146.27,14236.29,14037.65,13617.56,12326.47,11088.62,9704.73,8662.63,7317.61,6337.43,5540.84,5075.07,4815.79,4421.25,3996.34,3761.36,3274.78,2976.16,2897.78,2768.51],
         [2229.92,1930.16,1804.36,1665.27,1524.55,1303.18,1125.22,976.86,921.79,862.6,748.8,714.99,669.55,611.19,473.06,460.07,412.68,406.31,347.84,370.32,440.47,670.42,823.84,942.4,1404.68,1518.91,1757.99,2199.62,2919.84,3062.28,3592.33,4144.85,4989.91,5590.23,6283.04,6784.27,8036.49,8470.56,8732.9,9012.21,9396.46,9033.5,9233.38,9236.72,9802.5,9791.57,9313.42,9248,9551.91,9624.05,9806.4,9996.8,10263.21,10151.8,10128.28,10094.73,9848.41,9697.57,9797.47,9510.63,9686.24,9643.87,9241.96,9464.26,10024.31,10138.51,9665.19,9673.62,9855.04,9968.43,10827.1,11258.18,12110.43,12291.93,12587.3,12726.59,12793.4,12802.13,12516.65,12159.27,11237.86,9880.89,8664.08,7854.81,6728.04,5879.08,5177.21,4674.4,4431.75,4035.82,3706.41,3470.59,3114.32,2842.65,2657.48,2478.33],
         [2650.97,2359.65,2026.05,1874.78,1696.15,1473.79,1320.86,1264.54,1247.07,1115.16,1025.38,909.2,852.83,768.22,663.88,618.93,583.05,536.42,487.69,533.3,717.72,832.39,1211.98,1384.82,1929.35,2049.54,2378.6,2822.39,3569.94,3958.77,4895.86,5438.32,6495.19,7170.38,7868.33,8330.95,9357.15,9971.77,10649.05,10850.5,11584.88,11620.53,11910.72,12011.43,12301.18,12444.17,12204.19,12445.33,12831.2,13017.83,13115.57,12959.39,12798.49,12691.32,12433.53,12838.93,13393.98,12866.67,12335.17,12254.52,12326.45,12198.46,11933.77,12060.48,12548.45,12520.05,12072.95,11894.52,12108.19,12418.29,13738.22,14358.86,14934.96,15185.2,15730.98,16085.95,16334.82,15684.78,14931.16,14136.88,13035.04,11940.23,10811.28,9624.16,8186.86,7122.4,6151.8,5278.27,4987.12,4618.29,4170.67,3978.98,3690.74,3476.99,3274.05,3119.12],
         [3904.96,3472.8,3158.74,2917.75,2586.25,2281.18,2004.97,1998.14,1870.39,1702.11,1512.31,1246.34,1114.26,1028.14,942.64,903.15,899.29,849.8,868.24,876.96,975.29,1140.46,1511.35,2008.34,2664.49,2819.51,3149.59,3615.15,4751.65,5580.03,6522.55,7455.53,9350.81,10516.85,12005.32,13118.65,14672.86,15700.45,16486.12,16765.41,17757.93,17481.99,17103.77,16933.63,17282.37,17192.12,17870.83,18548.69,18758.08,18712.9,17854.17,18034.37,17970.32,17874.17,17924.73,17750.67,17841.78,17567.12,17619.31,17243.85,17206.87,16798.78,16283.16,16014.13,16049.92,16130.87,15715.05,15678.79,15837.8,16650.8,17608.81,18299.9,19589.77,20375.5,21147.06,21924.62,22911.94,22556.83,21803.17,20918.13,18812.94,17172.7,14888.59,13478.42,11674.55,10457.98,8849.14,7746.74,6978.17,6486.38,5857.42,5386.05,4912.08,4865.21,4618.67,4334.67]
         ])

    EVI_Weekday_L3 = np.array(
        [[502.54,461.14,143.63,0,0,0,0,200.76,0,0,0,15.9,119.2,119.17,0,178.78,89.14,0,0,0.06,178.81,115.71,0,0,0,438.03,798.49,512.84,857.97,1774.42,2922.23,2878.79,2145.52,2577.88,3103.85,2245.39,3167.03,3616.28,3445.62,4040.36,5993.43,5215.88,4126.65,4976.13,4217.15,3671.32,3718.91,3982.27,6505.89,5663.18,4079.08,3752.46,4871.96,4139.59,4062.28,3244.11,3965.81,3642.77,4141.56,4465.36,4781.34,3941.16,3045.27,2434.74,2884.26,2654.49,2876.73,2371.33,2379.45,2681.18,3206.8,3112.14,3727.78,3198.02,3430.38,3050.24,3522,3744.06,3279.37,2775.78,2158.02,1630.06,1435.44,1082.11,842.68,443.41,357.64,161.1,379.79,398.2,139.58,0,119.15,238.46,173.25,502.54],
         [59.6,59.6,59.6,59.6,3.34,0,0,0,0,0,0,0,0,0,0,178.83,66.32,0,0,0.09,204.97,204.97,107.66,59.6,59.6,119.23,301.7,313.82,624.74,796.48,1221.2,1371.04,1483.79,1201.37,1474.4,1653.26,3413.52,2942.84,2364.91,2216.69,2964.94,2542.32,2437.65,2523.27,2982.12,2569.01,3113.62,3630.06,3799.13,3499.52,3610.73,3845.88,4067.83,3343.22,2649.51,2298.36,2194.94,2218.06,2246.2,2607.15,3570.84,3298.04,2009.51,2093.5,1914.93,1657.42,2456.14,2277.31,2402.18,2160.46,2455.1,2852.68,3674.81,3535.25,3400.35,3147.23,2344.15,2487.57,2526.62,2638.76,1909.87,974.73,1007.5,745.49,383.78,408.78,242.56,119.2,206.43,205,96.15,0,119.12,178.81,178.83,131.3],
         [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,145.37,75.27,0,0,0,0,7.94,59.6,59.6,119.2,311.12,615.82,419.92,307.37,289.75,558.22,968.83,1619.97,1768.69,2006.8,1674.4,1703.88,1824.36,1440.82,1628.26,1931.94,1421.08,1998.95,2307.84,3216.75,2820.38,2577.21,2918.45,3419.97,3210.53,3342.73,3672.22,3061.06,2376.83,1236.49,1254.54,1701.82,1541.42,1320.86,1291.03,1515.71,1787.91,2077.6,1585.43,1900.16,1631.2,1261.38,1236.05,1699.4,1188.92,1071.78,1447.27,2668.41,2894.78,2459.34,1956.62,2227.62,2208.32,1679.98,1314.73,666.99,185.87,246.23,215.26,5.58,0,0,0,145.34,145.37,145.37,145.37,145.37,121.99,0,0],
         [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.03,79.46,273.27,422.33,421.31,319.15,186.97,413.75,545.6,449.83,518.04,1081.49,551.91,652.71,682.28,705.36,910.28,798.02,612.94,1195.09,1146.56,1159.67,1120.1,1026.25,875.56,1471.87,1389.56,2029.22,1734.09,1127.17,594.97,539.29,616.46,893.59,789.5,714.81,939.35,1142.35,1099.29,785.87,760.6,566.3,707.17,739.96,609.65,1276.49,1367.58,1318.56,981.48,540.54,831.78,811.02,1131.44,987.67,850.53,413.87,238.44,183.49,0,0,178.75,178.81,35.35,0.03,126.76,60.71,0,154.99,178.81,178.81,178.81],
         [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39.74,119.2,77.45,151.85,286.18,399.33,416.05,517.49,726.76,531.15,583.14,757.58,423.32,540.46,821.89,975.49,686.93,1302.22,1344.56,1499.67,1069.55,1440.59,1166.83,1083.09,915.42,789.21,1031.37,767.12,1084.31,470.3,604.91,707.25,382.03,292.37,558.74,808.17,489.02,576.77,838.61,748.74,793.57,526.68,683.53,643.18,161.16,295.39,575.46,961.54,719.41,410.73,403.9,648.03,690.42,377.03,310.25,227.39,59.6,202.65,166.13,51.43,0,0,0,0.03,72.95,5.67,0,0,0,0,0],
         [32.74,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,180.84,213.14,0,243.76,122.23,262.89,289.52,324.12,383.14,321.73,339.9,709.87,562.84,806.6,542.96,1343.86,1482.22,1464.75,1508.53,1220.85,1341.59,1457.89,1289.43,1587.56,1306.44,1285.01,1617.18,2000.7,2233.99,2286.41,2071.67,2840.5,2058.56,755.92,836.08,1136.21,1203.66,740.11,255.3,822.71,1293.12,1445.62,1525.98,1951.51,1560.52,1409.51,1049.75,1224.74,909.46,1323.62,1488.27,1792.82,828.64,585.43,678.97,1174.15,1658.18,1364.06,1634.22,1181.95,665.91,400.32,466.64,465.13,273.82,178.86,69.02,0,0,0,0,46.75,70.16,70.16,70.16],
         [652.97,608.11,275.83,135.46,0,0,0,145.4,64.75,0,0,19.39,145.37,145.37,145.37,290.77,280.39,145.37,5.44,0,0,162.7,383.81,312.23,298.76,480.71,760.37,1170.75,1903.82,1953.71,2020.06,1874.31,3082.8,2767.26,3334.82,2830.82,4152.87,4485.94,4379.1,4011.37,5584.59,4468.88,4686.64,4972.41,5723.19,5364.24,4336.71,4167.15,5317.08,4951.77,4531.79,3762.09,6144.5,5936.88,7062.57,5471.73,4092.95,3636.92,4289.05,4796.22,4800.55,4883.53,3492.6,2704.49,3482.86,3184.04,2700.8,2575.23,3761.25,3178.86,4512.63,3903.82,4439.63,4443.32,4832.8,5321.94,5166.91,5365.29,4002.07,3336.62,2418.38,1579.21,1045.38,670.85,840.38,680.51,701.38,396.31,270.53,205.81,119.2,93.76,0,0,483.06,744.12]
        ])
    EVI_Weekend_L2 = np.array(
        [[6431.4,5937.03,5267.98,4641.14,3918.22,3417.18,3012.3,2899.99,2841.95,2792.33,2299.29,2355.17,2253.12,2067.6,1708.53,1480.27,1324.44,1184.33,1124.12,1041.4,954.47,971.94,1037.1,1214.25,1292.86,1584.36,2042.62,2541.1,3651.87,4522.2,6170.78,7371.54,9903.33,10563.95,12347.47,14066.09,16026.93,17094.17,19156.13,19978.69,21461.47,22985.38,23644.75,23875.42,25406.52,26554.59,27817.65,28010.82,28354.83,28799.66,29092.58,30132.82,32307.9,33270.83,32801.72,33423.88,32875.54,32211.61,30724.59,30498.31,29351.48,29611.49,29063.1,27534.94,27072.2,28075.16,27997.04,27652.86,27805.53,28032.98,27843.33,27687.02,27965.35,29319.5,29028.79,28696.5,27548.46,27277.6,26898.83,25946.86,23695.6,22137.29,19793.78,18398.2,16287.92,14768.81,13772.56,12256.84,10309.81,9998.08,9587.47,9394.42,8539.35,7947.84,7644.66,6998.43],
         [6418.61,5791.13,5023.93,4213.87,3900.66,3510.28,3102.63,2822.16,2631.63,2428.32,2099.17,2079.63,1988.31,1796.4,1538.77,1265.97,1088.41,1036.55,994.53,908.77,802.18,826.6,916.91,1071.52,1304.72,1648.47,2039.66,2375.08,3189.91,3722.81,5017.24,5781.83,8164.1,8277.22,9734.53,11645.91,13826.29,14586.66,16131.39,16935.02,18752.06,19984.22,20754.47,21325.14,22437.25,23705.43,24957.88,25143.02,26716.53,27695.83,27762.06,28261.59,29906.77,31249.55,30491.21,31474.7,31312.67,30521.1,29666.67,28936.25,27918.8,28495.37,27563.46,26181.78,25102.32,24923.13,25064.78,25394.8,25447.11,25441.64,25484.61,26022.89,26002.36,27431.87,27632.16,27060.04,26364.59,25680.95,24672.52,23418.44,21686.56,20200.12,18625.68,17338.95,15129.15,13930.92,12836.78,11727.06,9934.79,9883.5,9517.32,8876.23,8213.17,7996.8,7728.57,7087.95],
         [6159.85,5694.2,5052.63,4463.27,3834.37,3388.98,2971.42,2698.68,2591.74,2358.13,2013.17,2057.36,1936.15,1744.99,1412.85,1076.61,996.69,942.46,858.53,777.06,886.87,851.61,1011.19,1041.66,1324.12,1518.27,1837.3,2333.92,3258.32,3641.66,4739.47,5417.68,6752.29,7582.06,9193.49,10902.52,12693.94,13292.31,15185.06,15570.32,17930.84,19055.24,18944.39,19302.78,20460.19,21395.09,22821.2,23100.78,24107.46,24855.13,25342.18,25548.25,26211.61,27937.58,27463.56,28298.77,27895.49,26708.68,25635.74,25932.85,26000.01,25836.84,25363.08,23808.35,22871.61,23255.13,22905.19,22973.78,23701.68,23654.9,23904.38,24280.25,24358.72,25406.58,25199.02,24588.17,23544.15,22820.82,22354.94,21591.08,20347.44,19362.67,17763.81,16481.88,14259.78,13549.56,12447.16,11316.65,9922.2,9804.71,9243.5,8808.58,8153.51,7924.18,7564.73,6971.63],
         [4639.43,4368.05,3821.22,3161.62,2677.48,2332.11,1967.52,1682.83,1551.74,1493.68,1263.29,1407.79,1372,1121.99,837.01,750.57,684.55,618.99,654.46,612.12,579.15,595.14,698.12,834.1,1109.61,1147.7,1392.88,1622.36,2353.54,2702.4,3830.76,4469.37,6333.13,6835.33,8085.65,8931.79,10404.6,10916.15,12316.24,12705.77,14922.17,15383.26,15995.9,16896.01,18018.2,18623.61,19375.23,20155.14,20748.83,21277.28,21464.87,21436.26,22565.06,23210.3,22991.46,23410.68,22883.77,21768.11,21050.68,21329.73,21128.51,20931.1,20042.1,18794.83,18113.83,18605.62,19262.75,19041.43,19565.41,19729.33,19323.57,20034.28,20018.2,20856.84,21112.7,21108.28,20231.7,19849.26,19998.87,18888.59,17129.15,15796.4,14777.7,13498.83,11757.99,10666.47,10059.92,8991.72,7671.84,7333.16,7010.85,6811.81,6232.74,5878.15,5456.81,5024.95],
         [5149.44,4460.97,3629.16,3050.27,2557.99,2194.53,1931.62,1565.17,1349.82,1306.38,1106.93,1259.6,1198.75,957.9,764.65,644.02,528.25,465.45,454.95,401.86,392.09,421.75,453.82,538.94,1070.56,983.43,1099.96,1282.34,2242.56,2640.01,3585.58,4112.43,5649.05,5987.64,7175.26,7861.29,9237.57,9548.92,11103.68,12121.39,13211.4,13797.01,14422.42,14701.36,15824.28,16131.85,16741.25,17196.2,18164.88,18417.27,18981.37,19350.61,19823.7,20520.57,20395.85,21360.9,21568.49,21159.13,20298.27,20000.79,19466.44,19130.02,18917,17969.42,17908.16,18367.94,18166.98,18329.59,18795,18185.06,17982.56,18174.68,18352.32,18709.26,19131.1,18412.24,18057.45,17344.97,17689.9,16803.06,15132.06,14067.19,13308.94,12665.19,10642.33,10112.61,9636,8812.36,7784.56,7417.18,7253.41,7048.12,6433.47,6121.82,6000.82,5830.5],
         [5369.5,4852.42,4039.8,3391.42,2898.27,2557.26,2305.77,2063.56,1926.41,1744.59,1499.03,1553.45,1441.23,1186.36,882.42,686.5,649.69,656.64,678.33,667.89,670.21,652.48,769.04,966.25,1360.92,1364.36,1659.83,2079.17,2941.79,3187.06,4066.93,4660.1,6650.53,7312.9,8541.27,9449.02,11526.27,11939.94,13220.91,13523.07,15668.53,16650.59,16953.14,17738.11,19317.32,20208.41,21318.89,22346.28,23442.77,23654.4,23668.1,23481.03,24068.27,24882.95,24917.61,26084.12,25804.98,25016.17,24381.19,24153.72,24265.77,24372.01,23366.8,21792.74,21109.96,21270.65,21255.8,21228.24,21674.14,21466.61,21017.04,21164.71,21235.94,21908.42,21918.6,21908.95,21447.02,20692.31,20703.3,19766.86,18074.23,16274.11,14583.43,13681.79,12104.44,11541.45,10359.56,9470.27,8702.52,8674,8152.18,7698.27,6872.74,6437.71,6053.56,5780.09],
         [7077.54,6582.44,5787.5,5286.64,4669.17,3984.24,3512.26,3193.49,3028.67,2876.87,2475.36,2633.38,2616.95,2496.79,1956.8,1765.4,1682.83,1466.87,1443.38,1188.37,1129.73,1053.79,942.52,1108.13,1320.45,1651.32,2068.47,2352.84,3413.29,4114.81,5376.16,6716.56,8920.98,9732.73,11481.73,13074.64,15275.45,16038.35,18286.7,19710.98,21606.43,23159.8,23825.94,24355.06,26582.21,28105.49,29744.24,30373,30950.06,32059.84,31777.27,31715.58,32669.64,34154.65,34627.34,35293.48,34160.18,33753.37,32313.8,32055.13,31353.08,31206.37,30280.75,29120.52,28666.15,28448.41,28486.68,28336.07,29165.9,30190.76,29673.33,30571.02,30368.67,31701.65,31077.61,30521.77,29726.22,28805.5,28518.63,27041.38,24521.94,22399.48,20651.76,19205.82,16959.94,15745.64,14438.82,13352.44,11356.91,11227.33,10634.66,10549.65,9488.68,8541.39,8087.54,7677.83]
        ])
    EVI_Weekend_L3 = np.array(
        [[59.6,59.6,0.84,0,0,0,0,0,0,168.86,0,0,0,0,0,0,0,0,0,0,0,0,0.06,217.15,118.01,39.74,59.6,99.35,633.09,1027.65,1184.59,2095.68,3521.12,3711.18,6418.67,5960.49,5120.43,6406.72,6276.18,4729.35,5332.06,6910.8,8814.02,6911.35,7214.42,5813.96,5323.86,5723.57,8580.7,8629.22,6459.66,5662.34,6711.94,8584.71,8551.94,6481.12,6162.76,4120.05,5338.63,4199.59,7168.19,7137.49,8086.96,5335.31,5360.43,6352.87,6339.56,5401.37,6396.34,5810.38,5493.13,3836.26,3795.23,4858.03,5003.49,3697.4,2765.08,3298.82,3755.17,3299.99,3512.63,3910.45,2668.76,1132.32,936.3,924,1375.75,1040.7,1783.31,1632.01,1080.71,920.19,246.75,18.55,297.98,434.42],
         [178.81,167.44,0,0,51.66,59.63,9.68,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39.77,238.38,226.6,4.86,0,59.69,514.93,1075.85,1211.25,1466.17,2003.14,2470.59,2693.82,3045.62,4227.21,4883.44,4476.64,3200.67,4130.31,5626.92,6809.31,7081.82,6178.75,6256.64,6250.04,6199.68,6999.83,7274.08,6156.45,5367.58,4727.05,4461,5989.48,6254.49,5209.92,4473.73,5741.36,5550.31,6487.86,4891.09,3665.1,2950.89,4128.01,4131.18,3618.4,4613.38,5740.46,4840.38,4139.32,3381.48,3134.87,2947.29,3101.44,2434.98,2224.51,2590.44,3796.83,3400.44,1938.13,1753.74,1776.94,1195.55,551.82,264.54,142.72,119.2,1046.37,1004.36,1072.95,999.27,582.64,779.71,944.76,710.22],
         [12.53,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,337.81,476.76,296.87,119.2,62.16,0,0,0.03,321.73,652.74,938.54,904.32,795.76,1360.72,1250.47,1463.59,1512.87,2138.07,2573.98,2780.2,2250.59,2119.06,2480.22,3799.77,4584.88,3306.21,3400.29,3210.15,4103.85,4112.78,6511.65,6528.77,5937.49,4907.17,4449.02,3754.67,3505.28,3681.93,3912.55,4140.98,4747.55,4446.64,5074.46,4454.19,4272.86,2966.1,2734.09,3366.33,4252.86,3627.42,3930.48,2892.11,2441.95,2483.36,2268.18,2558.77,2269.14,2045.76,2433.84,3288.41,3509.38,2611.37,1528.3,1145.92,841.84,536.36,361.68,300.07,157.99,110.63,167.67,264.57,300.74,387.41,214.6,50.5,62.68,62.68],
         [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,335.43,427.42,79.08,0,0,0,0,0,0,0,11.95,174.82,324.18,391.89,1181.57,1324.87,1380.17,1506.88,2261.2,1783.92,1342.29,1604.13,2021.37,2596.69,4117.17,3608.23,3061.81,2716.12,2512.23,3173.22,3794.68,3361.39,2398.17,2562.47,2799.27,2491.15,2434.25,1992.56,2391.66,2150.08,2809.94,2585.73,3325.46,4163.63,2792.56,1598.84,1205.15,2146.65,2922.26,2789.71,2641.11,2362.09,1791.42,1739.93,1664.14,1328.8,1377.18,1242.77,1499.03,1163.92,1041.23,912.57,817.53,866.35,410.73,733.36,474.46,209.19,277.05,277.05,100.45,59.6,59.6,59.6,59.6,59.6,187.7,154.09],
         [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,39.74,59.6,59.6,50.01,0,0,0,0.03,119.17,311.47,427.33,56.61,71.41,564.36,894.78,1091.55,841.9,521.21,1166.22,1132.4,1296,1977.35,1763.95,2011.31,2251.87,2174.07,1877.34,1438.06,2007.62,1875.91,1960.05,2418.4,2454.4,2080.56,2025.15,2672.63,2981.8,1805.55,2324.32,1840.36,1679.14,1562.23,2056.9,2370.43,1689.43,908.27,866.58,974.47,2456.75,2423.46,1752.49,1501.41,972.99,686.73,1193.84,1356.83,1155.95,1444.43,1139.58,750.81,101.76,270.3,271.52,705.02,717.37,378.89,91.61,119.9,315.69,213.75,204.94,205,184.24,119.2,115.07,59.6,59.6,58.76],
         [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0.03,91.18,139.67,354.5,491,556.33,297.86,1090.39,1553.13,1629.05,1795.93,1869.31,2618.06,2009.42,1983.75,2817.85,3347.87,3895.57,3385.09,3734.47,3414.71,3826.43,4092.14,4630.01,3943.68,3652.86,2873.53,2336.82,2786.34,4073.59,3035.33,3356.56,2732.72,3241.4,2742.32,2050.12,2969.53,2727,1540.28,1771.94,2199.68,2816.17,3920.43,3784.59,2710.51,2065.42,1702.28,1616.11,2425.24,2360.75,1647.39,1407.3,1305.83,1240.73,804.45,516.73,1040.7,939.44,643.81,124.52,89.05,67.95,59.6,472.89,757.58,688.88,720.6,171.04,0,97.66,97.72],
         [0,0,0,0,205.38,94.37,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,131.15,238.46,533.28,592.53,1088.36,2665.97,5046,4925.14,4568.11,4987.76,7372.88,6723.94,7025.06,7120.69,10759.33,9442.07,8920.14,8436.9,9001.89,7945.17,8908.42,9101.27,9699.23,8053.91,7528.94,7269.4,6703.1,7586.28,7542.64,8256.35,8254.08,6604.83,7826.63,6248.47,7435.79,5903.42,8202.47,7797.47,6184.21,5514.44,6001.31,6731.91,7488.04,6423.41,5427.1,3943.31,3965.55,5014.6,4748.86,3690.01,3030.59,3163.69,4509.49,4119.15,3339.21,2653.06,3402.88,1361.59,733.68,323.24,191.8,197.67,666.64,908.68,792.82,812.71,443.96,252.83,1023.84,981.07]
        ])

    EVI_load = ((EVI_Weekday_L2 + EVI_Weekday_L3) * 5 / 7 + (EVI_Weekend_L2 + EVI_Weekend_L3) * 2 / 7) / 1000 / 10 # kWh --> MWh, 145000 --> 14500 EVs
    EVI_load_weekday = (EVI_Weekday_L2 + EVI_Weekday_L3) / 1000 / 10
    EVI_load_weekend = (EVI_Weekend_L2 + EVI_Weekend_L3) / 1000 / 10


    high = np.max(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    low = np.min(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    mean = np.average(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    fig, ax = plt.subplots()
    tt = np.arange(0.5, 24 + 0.5)
    ax.plot(tt, mean, 'r')
    tt1 = np.arange(0, 24, 0.25)
    for i in range(7):
        ax.plot(tt1, EVI_load[i, :])
    # ax.plot(tt1, EVI_load_weekday)
    # ax.plot(tt1, EVI_load_weekend)

    ax.fill_between(tt, high, low, alpha=0.3, color='royalblue')

    plt.xlabel('Time (hour)')
    plt.ylabel('Charging loads (MWh)')
    plt.legend(['Average in simulations', 'Average in EVI-Pro'], fontsize=20, loc='upper left')
    plt.legend(['Average in simulations', u'-4\u00b0F EVI-Pro', u'14\u00b0F EVI-Pro', u'32\u00b0F EVI-Pro', u'50\u00b0F EVI-Pro', u'68\u00b0F EVI-Pro', u'86\u00b0F EVI-Pro', u'104\u00b0F EVI-Pro'], fontsize=17, loc='upper left')
    # plt.legend(['Simulation results', 'Average in EVI', 'Weekday in EVI', 'Weekday in EVI'], fontsize=12, loc='upper left')
    plt.grid()
    # df = pd.DataFrame(Days_T_S_demand.sum(axis=-1)) / 1000
    # df.plot.box()
    plt.xticks(np.arange(0, 24 + 1, 2))
    plt.show()
    fig.savefig('./results_ChargeModel/charging_demand_between_vsEVI_temperatures.pdf', dpi=600, bbox_inches='tight', pad_inches=0)
    mpl.rcParams['font.size'] = 12
    # </editor-fold>

def charging_demand_between_vsCalculation(Days_T_S_demand, Days_T_S_demand1):
    mpl.rcParams['font.size'] = 20
    # <editor-fold desc="plot conventional loads v.s. EV cahrging loads">
    high = np.max(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    low = np.min(Days_T_S_demand.sum(axis=-1), axis=0) / 1000
    mean = np.average(Days_T_S_demand.sum(axis=-1), axis=0) / 1000

    high1 = np.max(Days_T_S_demand1.sum(axis=-1), axis=0) / 1000
    low1 = np.min(Days_T_S_demand1.sum(axis=-1), axis=0) / 1000
    mean1 = np.average(Days_T_S_demand1.sum(axis=-1), axis=0) / 1000


    fig, ax = plt.subplots()
    tt = np.arange(0, 24) + 0.5
    ax.plot(tt, mean, 'r')
    ax.plot(tt, mean1)



    ax.fill_between(tt, high, low, alpha=0.3, color='royalblue')
    ax.fill_between(tt, high1, low1, alpha=0.3)

    plt.xlabel('Time (hour)')
    plt.ylabel('Charging loads (MWh)')
    plt.legend(['Charging loads of simulation', 'Charging loads of calulation'], fontsize=20, loc='upper left')
    plt.grid()
    # df = pd.DataFrame(Days_T_S_demand.sum(axis=-1)) / 1000
    # df.plot.box()
    plt.xticks(np.arange(0, 24 + 1, 2))
    plt.show()
    fig.savefig('./results_ChargeModel/charging_demand_between_vsCalculation.pdf', dpi=600, bbox_inches='tight', pad_inches=0)
    mpl.rcParams['font.size'] = 12
    # </editor-fold>

def fit_tmeperature_loads(temperatures, Days_T_S_load_ChargeModel):
    EVI_Weekday_L2 = np.array(
        [[3980.03, 3565.43, 3135.46, 2919.12, 2588.72, 2297.46, 2097.83, 2079.05, 1913.33, 1672.98, 1427.33,
          1226.25,
          1168.19, 976.54, 866.55, 806.66, 828.55, 851.05, 851, 828.64, 940.37, 1193.84, 1438.64, 1718.94, 2402.38,
          2571.01,
          2971.45, 3617.77, 4423.41, 4905.37, 6054.11, 7386.13, 9203.08, 10127.06, 11619.37, 12455.88, 13163.43,
          13995.73,
          14795.53, 15019.83, 16363.86, 16539.41, 16309.53, 16636.06, 17012.97, 17155.93, 17269.61, 17479.81,
          17745.49,
          17705.28, 17386.72, 17716.5, 17643.85, 17452.54, 17688.3, 17737.52, 17835.39, 17511.88, 16549.53,
          16059.63,
          16205.7, 16243.88, 15515.51, 15728.8, 15945.4, 16170, 14953.72, 14713.36, 15291.41, 16175.67, 17428.87,
          18185.67,
          19588.87, 20551.6, 21032.19, 21118.89, 21644.87, 21461.87, 21025.79, 20244.58, 18184.59, 16831.52,
          14489.12,
          12942.23, 11072.57, 9906.99, 8674.05, 7725.54, 7027.83, 6173.49, 5682.66, 5371.71, 4949.18, 4546.82,
          4396.08,
          4289.11],
         [3428.12, 2945.17, 2520.13, 2341.5, 2154.5, 1895.89, 1636.87, 1584.18, 1449.43, 1339.21, 1205.06, 1057.48,
          958.05,
          815.23, 731.94, 720.57, 733.91, 683.68, 656.49, 813.08, 995.46, 1127.02, 1443.03, 1675.36, 2311.15,
          2462.6,
          2883.91, 3601.75, 4220.7, 4731.12, 5875.13, 6952.67, 8294.67, 8806.54, 9755.72, 10566.28, 12119.15,
          12819.31,
          13641.08, 14156.28, 14420.62, 14160.9, 14453.38, 14637.04, 15154.1, 15140.72, 15130.23, 15563.05,
          15829.43,
          16057.02, 15812.97, 15632.74, 16062.86, 15964.01, 16321.5, 16451.03, 15906.41, 15331.65, 15320.14,
          14786.08,
          14812.59, 14673.56, 14144.21, 14605.59, 14681.29, 14653.09, 14169.91, 14427.94, 14935.11, 15226.32,
          15663.68,
          16538.22, 17502.72, 18238.38, 18818.99, 19529.91, 20144.88, 19852.08, 19040.74, 18166.6, 16794.33,
          15289.87,
          13589.83, 12028.7, 10294.46, 9255.3, 7922.9, 7000.44, 6429.6, 5864.49, 5447.19, 5070.62, 4665.88, 4281.12,
          4092.08, 3877.8],
         [3379.79, 3008.87, 2626.86, 2366.77, 2148.19, 1876.49, 1583.02, 1444.86, 1405.58, 1249.46, 1061.7, 963.22,
          890.36,
          785.38, 664.2, 625.41, 593.98, 531.04, 546.56, 603.49, 800.17, 1067.13, 1432.36, 1520.13, 2094.23,
          2378.83,
          2870.77, 3518.71, 4136.59, 4723.1, 5451.49, 6038.2, 7307.78, 8372.56, 9592.79, 10032.25, 11169.21,
          11434.37,
          11850.45, 12142.79, 12518.92, 12487.92, 12475.36, 12881.9, 13201.54, 13192.39, 13295.37, 13436.64,
          13562.12,
          13895.54, 13911.97, 13538.95, 13593.96, 13852.77, 13851.49, 14126.01, 14442.65, 13993.49, 13708.77,
          12811.57,
          12523.36, 12472.51, 12573.23, 12465.04, 13045.65, 13130.34, 12616.6, 12688.71, 12875.16, 13300.31,
          14473.33,
          15561.42, 16551.28, 17317.46, 17800.24, 18368.17, 18829.02, 18289.87, 17562.18, 16893.8, 15510.95,
          14171.48,
          12262.48, 10901.01, 9381.6, 7992.01, 6879.61, 6161.83, 5991.89, 5656.81, 5109.09, 4801.63, 4291.26,
          3945.34,
          3816.86, 3675.07],
         [2428.84, 2148.25, 1908.59, 1780.78, 1614.16, 1439.42, 1265.13, 1219.07, 1044.22, 820.61, 674.87, 552.96,
          544.27,
          513.65, 430.64, 409.33, 381.13, 391.07, 408.84, 474.52, 509.93, 639.08, 1055.76, 1219.74, 1602.06,
          1778.46,
          2182.79, 2651.67, 3518.8, 3982.59, 4487.6, 4880.22, 5915.31, 6597.94, 7315.98, 7611.28, 8437.83, 9030.73,
          9399.94,
          9850.27, 10405.12, 10349.91, 10589.68, 10694.09, 11320.05, 11445.65, 11413.81, 11183.52, 11172.03,
          10926.68,
          11165.06, 10836.64, 10967.85, 11105.11, 11548.34, 11712.64, 11886.27, 11541.45, 10732.14, 10508.3,
          10883.04,
          10912.61, 10401.43, 10341.91, 10171.63, 10135.2, 10217.88, 10483.76, 10970.61, 10936.5, 11492.52,
          11999.22,
          12354.76, 12867.83, 13089.29, 13482.83, 14146.27, 14236.29, 14037.65, 13617.56, 12326.47, 11088.62,
          9704.73,
          8662.63, 7317.61, 6337.43, 5540.84, 5075.07, 4815.79, 4421.25, 3996.34, 3761.36, 3274.78, 2976.16,
          2897.78,
          2768.51],
         [2229.92, 1930.16, 1804.36, 1665.27, 1524.55, 1303.18, 1125.22, 976.86, 921.79, 862.6, 748.8, 714.99,
          669.55,
          611.19, 473.06, 460.07, 412.68, 406.31, 347.84, 370.32, 440.47, 670.42, 823.84, 942.4, 1404.68, 1518.91,
          1757.99,
          2199.62, 2919.84, 3062.28, 3592.33, 4144.85, 4989.91, 5590.23, 6283.04, 6784.27, 8036.49, 8470.56, 8732.9,
          9012.21, 9396.46, 9033.5, 9233.38, 9236.72, 9802.5, 9791.57, 9313.42, 9248, 9551.91, 9624.05, 9806.4,
          9996.8,
          10263.21, 10151.8, 10128.28, 10094.73, 9848.41, 9697.57, 9797.47, 9510.63, 9686.24, 9643.87, 9241.96,
          9464.26,
          10024.31, 10138.51, 9665.19, 9673.62, 9855.04, 9968.43, 10827.1, 11258.18, 12110.43, 12291.93, 12587.3,
          12726.59,
          12793.4, 12802.13, 12516.65, 12159.27, 11237.86, 9880.89, 8664.08, 7854.81, 6728.04, 5879.08, 5177.21,
          4674.4,
          4431.75, 4035.82, 3706.41, 3470.59, 3114.32, 2842.65, 2657.48, 2478.33],
         [2650.97, 2359.65, 2026.05, 1874.78, 1696.15, 1473.79, 1320.86, 1264.54, 1247.07, 1115.16, 1025.38, 909.2,
          852.83,
          768.22, 663.88, 618.93, 583.05, 536.42, 487.69, 533.3, 717.72, 832.39, 1211.98, 1384.82, 1929.35, 2049.54,
          2378.6,
          2822.39, 3569.94, 3958.77, 4895.86, 5438.32, 6495.19, 7170.38, 7868.33, 8330.95, 9357.15, 9971.77,
          10649.05,
          10850.5, 11584.88, 11620.53, 11910.72, 12011.43, 12301.18, 12444.17, 12204.19, 12445.33, 12831.2,
          13017.83,
          13115.57, 12959.39, 12798.49, 12691.32, 12433.53, 12838.93, 13393.98, 12866.67, 12335.17, 12254.52,
          12326.45,
          12198.46, 11933.77, 12060.48, 12548.45, 12520.05, 12072.95, 11894.52, 12108.19, 12418.29, 13738.22,
          14358.86,
          14934.96, 15185.2, 15730.98, 16085.95, 16334.82, 15684.78, 14931.16, 14136.88, 13035.04, 11940.23,
          10811.28,
          9624.16, 8186.86, 7122.4, 6151.8, 5278.27, 4987.12, 4618.29, 4170.67, 3978.98, 3690.74, 3476.99, 3274.05,
          3119.12],
         [3904.96, 3472.8, 3158.74, 2917.75, 2586.25, 2281.18, 2004.97, 1998.14, 1870.39, 1702.11, 1512.31, 1246.34,
          1114.26, 1028.14, 942.64, 903.15, 899.29, 849.8, 868.24, 876.96, 975.29, 1140.46, 1511.35, 2008.34,
          2664.49,
          2819.51, 3149.59, 3615.15, 4751.65, 5580.03, 6522.55, 7455.53, 9350.81, 10516.85, 12005.32, 13118.65,
          14672.86,
          15700.45, 16486.12, 16765.41, 17757.93, 17481.99, 17103.77, 16933.63, 17282.37, 17192.12, 17870.83,
          18548.69,
          18758.08, 18712.9, 17854.17, 18034.37, 17970.32, 17874.17, 17924.73, 17750.67, 17841.78, 17567.12,
          17619.31,
          17243.85, 17206.87, 16798.78, 16283.16, 16014.13, 16049.92, 16130.87, 15715.05, 15678.79, 15837.8,
          16650.8,
          17608.81, 18299.9, 19589.77, 20375.5, 21147.06, 21924.62, 22911.94, 22556.83, 21803.17, 20918.13,
          18812.94,
          17172.7, 14888.59, 13478.42, 11674.55, 10457.98, 8849.14, 7746.74, 6978.17, 6486.38, 5857.42, 5386.05,
          4912.08,
          4865.21, 4618.67, 4334.67]
         ])

    EVI_Weekday_L3 = np.array(
        [[502.54, 461.14, 143.63, 0, 0, 0, 0, 200.76, 0, 0, 0, 15.9, 119.2, 119.17, 0, 178.78, 89.14, 0, 0, 0.06,
          178.81,
          115.71, 0, 0, 0, 438.03, 798.49, 512.84, 857.97, 1774.42, 2922.23, 2878.79, 2145.52, 2577.88, 3103.85,
          2245.39,
          3167.03, 3616.28, 3445.62, 4040.36, 5993.43, 5215.88, 4126.65, 4976.13, 4217.15, 3671.32, 3718.91,
          3982.27,
          6505.89, 5663.18, 4079.08, 3752.46, 4871.96, 4139.59, 4062.28, 3244.11, 3965.81, 3642.77, 4141.56,
          4465.36,
          4781.34, 3941.16, 3045.27, 2434.74, 2884.26, 2654.49, 2876.73, 2371.33, 2379.45, 2681.18, 3206.8, 3112.14,
          3727.78, 3198.02, 3430.38, 3050.24, 3522, 3744.06, 3279.37, 2775.78, 2158.02, 1630.06, 1435.44, 1082.11,
          842.68,
          443.41, 357.64, 161.1, 379.79, 398.2, 139.58, 0, 119.15, 238.46, 173.25, 502.54],
         [59.6, 59.6, 59.6, 59.6, 3.34, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 178.83, 66.32, 0, 0, 0.09, 204.97, 204.97,
          107.66,
          59.6, 59.6, 119.23, 301.7, 313.82, 624.74, 796.48, 1221.2, 1371.04, 1483.79, 1201.37, 1474.4, 1653.26,
          3413.52,
          2942.84, 2364.91, 2216.69, 2964.94, 2542.32, 2437.65, 2523.27, 2982.12, 2569.01, 3113.62, 3630.06,
          3799.13,
          3499.52, 3610.73, 3845.88, 4067.83, 3343.22, 2649.51, 2298.36, 2194.94, 2218.06, 2246.2, 2607.15, 3570.84,
          3298.04, 2009.51, 2093.5, 1914.93, 1657.42, 2456.14, 2277.31, 2402.18, 2160.46, 2455.1, 2852.68, 3674.81,
          3535.25,
          3400.35, 3147.23, 2344.15, 2487.57, 2526.62, 2638.76, 1909.87, 974.73, 1007.5, 745.49, 383.78, 408.78,
          242.56,
          119.2, 206.43, 205, 96.15, 0, 119.12, 178.81, 178.83, 131.3],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 145.37, 75.27, 0, 0, 0, 0, 7.94, 59.6, 59.6, 119.2, 311.12,
          615.82,
          419.92, 307.37, 289.75, 558.22, 968.83, 1619.97, 1768.69, 2006.8, 1674.4, 1703.88, 1824.36, 1440.82,
          1628.26,
          1931.94, 1421.08, 1998.95, 2307.84, 3216.75, 2820.38, 2577.21, 2918.45, 3419.97, 3210.53, 3342.73,
          3672.22,
          3061.06, 2376.83, 1236.49, 1254.54, 1701.82, 1541.42, 1320.86, 1291.03, 1515.71, 1787.91, 2077.6, 1585.43,
          1900.16, 1631.2, 1261.38, 1236.05, 1699.4, 1188.92, 1071.78, 1447.27, 2668.41, 2894.78, 2459.34, 1956.62,
          2227.62,
          2208.32, 1679.98, 1314.73, 666.99, 185.87, 246.23, 215.26, 5.58, 0, 0, 0, 145.34, 145.37, 145.37, 145.37,
          145.37,
          121.99, 0, 0],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.03, 79.46, 273.27, 422.33,
          421.31,
          319.15, 186.97, 413.75, 545.6, 449.83, 518.04, 1081.49, 551.91, 652.71, 682.28, 705.36, 910.28, 798.02,
          612.94,
          1195.09, 1146.56, 1159.67, 1120.1, 1026.25, 875.56, 1471.87, 1389.56, 2029.22, 1734.09, 1127.17, 594.97,
          539.29,
          616.46, 893.59, 789.5, 714.81, 939.35, 1142.35, 1099.29, 785.87, 760.6, 566.3, 707.17, 739.96, 609.65,
          1276.49,
          1367.58, 1318.56, 981.48, 540.54, 831.78, 811.02, 1131.44, 987.67, 850.53, 413.87, 238.44, 183.49, 0, 0,
          178.75,
          178.81, 35.35, 0.03, 126.76, 60.71, 0, 154.99, 178.81, 178.81, 178.81],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 39.74, 119.2, 77.45, 151.85,
          286.18,
          399.33, 416.05, 517.49, 726.76, 531.15, 583.14, 757.58, 423.32, 540.46, 821.89, 975.49, 686.93, 1302.22,
          1344.56,
          1499.67, 1069.55, 1440.59, 1166.83, 1083.09, 915.42, 789.21, 1031.37, 767.12, 1084.31, 470.3, 604.91,
          707.25,
          382.03, 292.37, 558.74, 808.17, 489.02, 576.77, 838.61, 748.74, 793.57, 526.68, 683.53, 643.18, 161.16,
          295.39,
          575.46, 961.54, 719.41, 410.73, 403.9, 648.03, 690.42, 377.03, 310.25, 227.39, 59.6, 202.65, 166.13,
          51.43, 0,
          0,
          0, 0.03, 72.95, 5.67, 0, 0, 0, 0, 0],
         [32.74, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 180.84, 213.14, 0, 243.76, 122.23,
          262.89,
          289.52, 324.12, 383.14, 321.73, 339.9, 709.87, 562.84, 806.6, 542.96, 1343.86, 1482.22, 1464.75, 1508.53,
          1220.85,
          1341.59, 1457.89, 1289.43, 1587.56, 1306.44, 1285.01, 1617.18, 2000.7, 2233.99, 2286.41, 2071.67, 2840.5,
          2058.56,
          755.92, 836.08, 1136.21, 1203.66, 740.11, 255.3, 822.71, 1293.12, 1445.62, 1525.98, 1951.51, 1560.52,
          1409.51,
          1049.75, 1224.74, 909.46, 1323.62, 1488.27, 1792.82, 828.64, 585.43, 678.97, 1174.15, 1658.18, 1364.06,
          1634.22,
          1181.95, 665.91, 400.32, 466.64, 465.13, 273.82, 178.86, 69.02, 0, 0, 0, 0, 46.75, 70.16, 70.16, 70.16],
         [652.97, 608.11, 275.83, 135.46, 0, 0, 0, 145.4, 64.75, 0, 0, 19.39, 145.37, 145.37, 145.37, 290.77,
          280.39,
          145.37, 5.44, 0, 0, 162.7, 383.81, 312.23, 298.76, 480.71, 760.37, 1170.75, 1903.82, 1953.71, 2020.06,
          1874.31,
          3082.8, 2767.26, 3334.82, 2830.82, 4152.87, 4485.94, 4379.1, 4011.37, 5584.59, 4468.88, 4686.64, 4972.41,
          5723.19,
          5364.24, 4336.71, 4167.15, 5317.08, 4951.77, 4531.79, 3762.09, 6144.5, 5936.88, 7062.57, 5471.73, 4092.95,
          3636.92, 4289.05, 4796.22, 4800.55, 4883.53, 3492.6, 2704.49, 3482.86, 3184.04, 2700.8, 2575.23, 3761.25,
          3178.86,
          4512.63, 3903.82, 4439.63, 4443.32, 4832.8, 5321.94, 5166.91, 5365.29, 4002.07, 3336.62, 2418.38, 1579.21,
          1045.38, 670.85, 840.38, 680.51, 701.38, 396.31, 270.53, 205.81, 119.2, 93.76, 0, 0, 483.06, 744.12]
         ])
    EVI_Weekend_L2 = np.array(
        [[6431.4, 5937.03, 5267.98, 4641.14, 3918.22, 3417.18, 3012.3, 2899.99, 2841.95, 2792.33, 2299.29, 2355.17,
          2253.12,
          2067.6, 1708.53, 1480.27, 1324.44, 1184.33, 1124.12, 1041.4, 954.47, 971.94, 1037.1, 1214.25, 1292.86,
          1584.36,
          2042.62, 2541.1, 3651.87, 4522.2, 6170.78, 7371.54, 9903.33, 10563.95, 12347.47, 14066.09, 16026.93,
          17094.17,
          19156.13, 19978.69, 21461.47, 22985.38, 23644.75, 23875.42, 25406.52, 26554.59, 27817.65, 28010.82,
          28354.83,
          28799.66, 29092.58, 30132.82, 32307.9, 33270.83, 32801.72, 33423.88, 32875.54, 32211.61, 30724.59,
          30498.31,
          29351.48, 29611.49, 29063.1, 27534.94, 27072.2, 28075.16, 27997.04, 27652.86, 27805.53, 28032.98,
          27843.33,
          27687.02, 27965.35, 29319.5, 29028.79, 28696.5, 27548.46, 27277.6, 26898.83, 25946.86, 23695.6, 22137.29,
          19793.78, 18398.2, 16287.92, 14768.81, 13772.56, 12256.84, 10309.81, 9998.08, 9587.47, 9394.42, 8539.35,
          7947.84,
          7644.66, 6998.43],
         [6418.61, 5791.13, 5023.93, 4213.87, 3900.66, 3510.28, 3102.63, 2822.16, 2631.63, 2428.32, 2099.17,
          2079.63,
          1988.31, 1796.4, 1538.77, 1265.97, 1088.41, 1036.55, 994.53, 908.77, 802.18, 826.6, 916.91, 1071.52,
          1304.72,
          1648.47, 2039.66, 2375.08, 3189.91, 3722.81, 5017.24, 5781.83, 8164.1, 8277.22, 9734.53, 11645.91,
          13826.29,
          14586.66, 16131.39, 16935.02, 18752.06, 19984.22, 20754.47, 21325.14, 22437.25, 23705.43, 24957.88,
          25143.02,
          26716.53, 27695.83, 27762.06, 28261.59, 29906.77, 31249.55, 30491.21, 31474.7, 31312.67, 30521.1,
          29666.67,
          28936.25, 27918.8, 28495.37, 27563.46, 26181.78, 25102.32, 24923.13, 25064.78, 25394.8, 25447.11,
          25441.64,
          25484.61, 26022.89, 26002.36, 27431.87, 27632.16, 27060.04, 26364.59, 25680.95, 24672.52, 23418.44,
          21686.56,
          20200.12, 18625.68, 17338.95, 15129.15, 13930.92, 12836.78, 11727.06, 9934.79, 9883.5, 9517.32, 8876.23,
          8213.17,
          7996.8, 7728.57, 7087.95],
         [6159.85, 5694.2, 5052.63, 4463.27, 3834.37, 3388.98, 2971.42, 2698.68, 2591.74, 2358.13, 2013.17, 2057.36,
          1936.15, 1744.99, 1412.85, 1076.61, 996.69, 942.46, 858.53, 777.06, 886.87, 851.61, 1011.19, 1041.66,
          1324.12,
          1518.27, 1837.3, 2333.92, 3258.32, 3641.66, 4739.47, 5417.68, 6752.29, 7582.06, 9193.49, 10902.52,
          12693.94,
          13292.31, 15185.06, 15570.32, 17930.84, 19055.24, 18944.39, 19302.78, 20460.19, 21395.09, 22821.2,
          23100.78,
          24107.46, 24855.13, 25342.18, 25548.25, 26211.61, 27937.58, 27463.56, 28298.77, 27895.49, 26708.68,
          25635.74,
          25932.85, 26000.01, 25836.84, 25363.08, 23808.35, 22871.61, 23255.13, 22905.19, 22973.78, 23701.68,
          23654.9,
          23904.38, 24280.25, 24358.72, 25406.58, 25199.02, 24588.17, 23544.15, 22820.82, 22354.94, 21591.08,
          20347.44,
          19362.67, 17763.81, 16481.88, 14259.78, 13549.56, 12447.16, 11316.65, 9922.2, 9804.71, 9243.5, 8808.58,
          8153.51,
          7924.18, 7564.73, 6971.63],
         [4639.43, 4368.05, 3821.22, 3161.62, 2677.48, 2332.11, 1967.52, 1682.83, 1551.74, 1493.68, 1263.29,
          1407.79,
          1372,
          1121.99, 837.01, 750.57, 684.55, 618.99, 654.46, 612.12, 579.15, 595.14, 698.12, 834.1, 1109.61, 1147.7,
          1392.88,
          1622.36, 2353.54, 2702.4, 3830.76, 4469.37, 6333.13, 6835.33, 8085.65, 8931.79, 10404.6, 10916.15,
          12316.24,
          12705.77, 14922.17, 15383.26, 15995.9, 16896.01, 18018.2, 18623.61, 19375.23, 20155.14, 20748.83,
          21277.28,
          21464.87, 21436.26, 22565.06, 23210.3, 22991.46, 23410.68, 22883.77, 21768.11, 21050.68, 21329.73,
          21128.51,
          20931.1, 20042.1, 18794.83, 18113.83, 18605.62, 19262.75, 19041.43, 19565.41, 19729.33, 19323.57,
          20034.28,
          20018.2, 20856.84, 21112.7, 21108.28, 20231.7, 19849.26, 19998.87, 18888.59, 17129.15, 15796.4, 14777.7,
          13498.83,
          11757.99, 10666.47, 10059.92, 8991.72, 7671.84, 7333.16, 7010.85, 6811.81, 6232.74, 5878.15, 5456.81,
          5024.95],
         [5149.44, 4460.97, 3629.16, 3050.27, 2557.99, 2194.53, 1931.62, 1565.17, 1349.82, 1306.38, 1106.93, 1259.6,
          1198.75, 957.9, 764.65, 644.02, 528.25, 465.45, 454.95, 401.86, 392.09, 421.75, 453.82, 538.94, 1070.56,
          983.43,
          1099.96, 1282.34, 2242.56, 2640.01, 3585.58, 4112.43, 5649.05, 5987.64, 7175.26, 7861.29, 9237.57,
          9548.92,
          11103.68, 12121.39, 13211.4, 13797.01, 14422.42, 14701.36, 15824.28, 16131.85, 16741.25, 17196.2,
          18164.88,
          18417.27, 18981.37, 19350.61, 19823.7, 20520.57, 20395.85, 21360.9, 21568.49, 21159.13, 20298.27,
          20000.79,
          19466.44, 19130.02, 18917, 17969.42, 17908.16, 18367.94, 18166.98, 18329.59, 18795, 18185.06, 17982.56,
          18174.68,
          18352.32, 18709.26, 19131.1, 18412.24, 18057.45, 17344.97, 17689.9, 16803.06, 15132.06, 14067.19,
          13308.94,
          12665.19, 10642.33, 10112.61, 9636, 8812.36, 7784.56, 7417.18, 7253.41, 7048.12, 6433.47, 6121.82,
          6000.82,
          5830.5],
         [5369.5, 4852.42, 4039.8, 3391.42, 2898.27, 2557.26, 2305.77, 2063.56, 1926.41, 1744.59, 1499.03, 1553.45,
          1441.23,
          1186.36, 882.42, 686.5, 649.69, 656.64, 678.33, 667.89, 670.21, 652.48, 769.04, 966.25, 1360.92, 1364.36,
          1659.83,
          2079.17, 2941.79, 3187.06, 4066.93, 4660.1, 6650.53, 7312.9, 8541.27, 9449.02, 11526.27, 11939.94,
          13220.91,
          13523.07, 15668.53, 16650.59, 16953.14, 17738.11, 19317.32, 20208.41, 21318.89, 22346.28, 23442.77,
          23654.4,
          23668.1, 23481.03, 24068.27, 24882.95, 24917.61, 26084.12, 25804.98, 25016.17, 24381.19, 24153.72,
          24265.77,
          24372.01, 23366.8, 21792.74, 21109.96, 21270.65, 21255.8, 21228.24, 21674.14, 21466.61, 21017.04,
          21164.71,
          21235.94, 21908.42, 21918.6, 21908.95, 21447.02, 20692.31, 20703.3, 19766.86, 18074.23, 16274.11,
          14583.43,
          13681.79, 12104.44, 11541.45, 10359.56, 9470.27, 8702.52, 8674, 8152.18, 7698.27, 6872.74, 6437.71,
          6053.56,
          5780.09],
         [7077.54, 6582.44, 5787.5, 5286.64, 4669.17, 3984.24, 3512.26, 3193.49, 3028.67, 2876.87, 2475.36, 2633.38,
          2616.95, 2496.79, 1956.8, 1765.4, 1682.83, 1466.87, 1443.38, 1188.37, 1129.73, 1053.79, 942.52, 1108.13,
          1320.45,
          1651.32, 2068.47, 2352.84, 3413.29, 4114.81, 5376.16, 6716.56, 8920.98, 9732.73, 11481.73, 13074.64,
          15275.45,
          16038.35, 18286.7, 19710.98, 21606.43, 23159.8, 23825.94, 24355.06, 26582.21, 28105.49, 29744.24, 30373,
          30950.06,
          32059.84, 31777.27, 31715.58, 32669.64, 34154.65, 34627.34, 35293.48, 34160.18, 33753.37, 32313.8,
          32055.13,
          31353.08, 31206.37, 30280.75, 29120.52, 28666.15, 28448.41, 28486.68, 28336.07, 29165.9, 30190.76,
          29673.33,
          30571.02, 30368.67, 31701.65, 31077.61, 30521.77, 29726.22, 28805.5, 28518.63, 27041.38, 24521.94,
          22399.48,
          20651.76, 19205.82, 16959.94, 15745.64, 14438.82, 13352.44, 11356.91, 11227.33, 10634.66, 10549.65,
          9488.68,
          8541.39, 8087.54, 7677.83]
         ])
    EVI_Weekend_L3 = np.array(
        [[59.6, 59.6, 0.84, 0, 0, 0, 0, 0, 0, 168.86, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.06, 217.15, 118.01,
          39.74,
          59.6,
          99.35, 633.09, 1027.65, 1184.59, 2095.68, 3521.12, 3711.18, 6418.67, 5960.49, 5120.43, 6406.72, 6276.18,
          4729.35,
          5332.06, 6910.8, 8814.02, 6911.35, 7214.42, 5813.96, 5323.86, 5723.57, 8580.7, 8629.22, 6459.66, 5662.34,
          6711.94,
          8584.71, 8551.94, 6481.12, 6162.76, 4120.05, 5338.63, 4199.59, 7168.19, 7137.49, 8086.96, 5335.31,
          5360.43,
          6352.87, 6339.56, 5401.37, 6396.34, 5810.38, 5493.13, 3836.26, 3795.23, 4858.03, 5003.49, 3697.4, 2765.08,
          3298.82, 3755.17, 3299.99, 3512.63, 3910.45, 2668.76, 1132.32, 936.3, 924, 1375.75, 1040.7, 1783.31,
          1632.01,
          1080.71, 920.19, 246.75, 18.55, 297.98, 434.42],
         [178.81, 167.44, 0, 0, 51.66, 59.63, 9.68, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 39.77, 238.38,
          226.6,
          4.86,
          0, 59.69, 514.93, 1075.85, 1211.25, 1466.17, 2003.14, 2470.59, 2693.82, 3045.62, 4227.21, 4883.44,
          4476.64,
          3200.67, 4130.31, 5626.92, 6809.31, 7081.82, 6178.75, 6256.64, 6250.04, 6199.68, 6999.83, 7274.08,
          6156.45,
          5367.58, 4727.05, 4461, 5989.48, 6254.49, 5209.92, 4473.73, 5741.36, 5550.31, 6487.86, 4891.09, 3665.1,
          2950.89,
          4128.01, 4131.18, 3618.4, 4613.38, 5740.46, 4840.38, 4139.32, 3381.48, 3134.87, 2947.29, 3101.44, 2434.98,
          2224.51, 2590.44, 3796.83, 3400.44, 1938.13, 1753.74, 1776.94, 1195.55, 551.82, 264.54, 142.72, 119.2,
          1046.37,
          1004.36, 1072.95, 999.27, 582.64, 779.71, 944.76, 710.22],
         [12.53, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 337.81, 476.76, 296.87, 119.2, 62.16, 0, 0,
          0.03,
          321.73, 652.74, 938.54, 904.32, 795.76, 1360.72, 1250.47, 1463.59, 1512.87, 2138.07, 2573.98, 2780.2,
          2250.59,
          2119.06, 2480.22, 3799.77, 4584.88, 3306.21, 3400.29, 3210.15, 4103.85, 4112.78, 6511.65, 6528.77,
          5937.49,
          4907.17, 4449.02, 3754.67, 3505.28, 3681.93, 3912.55, 4140.98, 4747.55, 4446.64, 5074.46, 4454.19,
          4272.86,
          2966.1, 2734.09, 3366.33, 4252.86, 3627.42, 3930.48, 2892.11, 2441.95, 2483.36, 2268.18, 2558.77, 2269.14,
          2045.76, 2433.84, 3288.41, 3509.38, 2611.37, 1528.3, 1145.92, 841.84, 536.36, 361.68, 300.07, 157.99,
          110.63,
          167.67, 264.57, 300.74, 387.41, 214.6, 50.5, 62.68, 62.68],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 335.43, 427.42, 79.08, 0, 0, 0, 0, 0, 0, 0, 11.95,
          174.82,
          324.18, 391.89, 1181.57, 1324.87, 1380.17, 1506.88, 2261.2, 1783.92, 1342.29, 1604.13, 2021.37, 2596.69,
          4117.17,
          3608.23, 3061.81, 2716.12, 2512.23, 3173.22, 3794.68, 3361.39, 2398.17, 2562.47, 2799.27, 2491.15,
          2434.25,
          1992.56, 2391.66, 2150.08, 2809.94, 2585.73, 3325.46, 4163.63, 2792.56, 1598.84, 1205.15, 2146.65,
          2922.26,
          2789.71, 2641.11, 2362.09, 1791.42, 1739.93, 1664.14, 1328.8, 1377.18, 1242.77, 1499.03, 1163.92, 1041.23,
          912.57,
          817.53, 866.35, 410.73, 733.36, 474.46, 209.19, 277.05, 277.05, 100.45, 59.6, 59.6, 59.6, 59.6, 59.6,
          187.7,
          154.09],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 39.74, 59.6, 59.6, 50.01, 0, 0, 0, 0.03, 119.17,
          311.47,
          427.33, 56.61, 71.41, 564.36, 894.78, 1091.55, 841.9, 521.21, 1166.22, 1132.4, 1296, 1977.35, 1763.95,
          2011.31,
          2251.87, 2174.07, 1877.34, 1438.06, 2007.62, 1875.91, 1960.05, 2418.4, 2454.4, 2080.56, 2025.15, 2672.63,
          2981.8,
          1805.55, 2324.32, 1840.36, 1679.14, 1562.23, 2056.9, 2370.43, 1689.43, 908.27, 866.58, 974.47, 2456.75,
          2423.46,
          1752.49, 1501.41, 972.99, 686.73, 1193.84, 1356.83, 1155.95, 1444.43, 1139.58, 750.81, 101.76, 270.3,
          271.52,
          705.02, 717.37, 378.89, 91.61, 119.9, 315.69, 213.75, 204.94, 205, 184.24, 119.2, 115.07, 59.6, 59.6,
          58.76],
         [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.03, 91.18, 139.67, 354.5,
          491,
          556.33, 297.86, 1090.39, 1553.13, 1629.05, 1795.93, 1869.31, 2618.06, 2009.42, 1983.75, 2817.85, 3347.87,
          3895.57,
          3385.09, 3734.47, 3414.71, 3826.43, 4092.14, 4630.01, 3943.68, 3652.86, 2873.53, 2336.82, 2786.34,
          4073.59,
          3035.33, 3356.56, 2732.72, 3241.4, 2742.32, 2050.12, 2969.53, 2727, 1540.28, 1771.94, 2199.68, 2816.17,
          3920.43,
          3784.59, 2710.51, 2065.42, 1702.28, 1616.11, 2425.24, 2360.75, 1647.39, 1407.3, 1305.83, 1240.73, 804.45,
          516.73,
          1040.7, 939.44, 643.81, 124.52, 89.05, 67.95, 59.6, 472.89, 757.58, 688.88, 720.6, 171.04, 0, 97.66,
          97.72],
         [0, 0, 0, 0, 205.38, 94.37, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 131.15, 238.46,
          533.28,
          592.53, 1088.36, 2665.97, 5046, 4925.14, 4568.11, 4987.76, 7372.88, 6723.94, 7025.06, 7120.69, 10759.33,
          9442.07,
          8920.14, 8436.9, 9001.89, 7945.17, 8908.42, 9101.27, 9699.23, 8053.91, 7528.94, 7269.4, 6703.1, 7586.28,
          7542.64,
          8256.35, 8254.08, 6604.83, 7826.63, 6248.47, 7435.79, 5903.42, 8202.47, 7797.47, 6184.21, 5514.44,
          6001.31,
          6731.91, 7488.04, 6423.41, 5427.1, 3943.31, 3965.55, 5014.6, 4748.86, 3690.01, 3030.59, 3163.69, 4509.49,
          4119.15,
          3339.21, 2653.06, 3402.88, 1361.59, 733.68, 323.24, 191.8, 197.67, 666.64, 908.68, 792.82, 812.71, 443.96,
          252.83,
          1023.84, 981.07]
         ])

    EVI_load = ((EVI_Weekday_L2 + EVI_Weekday_L3) * 5 / 7 + (
            EVI_Weekend_L2 + EVI_Weekend_L3) * 2 / 7) / 1000 / 10  # kWh --> MWh, 145000 --> 14500 EVs

    def Curve_Fitting(x, y, deg, save_path = 1):
        from sklearn.metrics import r2_score
        parameter = np.polyfit(x, y, deg)  # deg
        p = np.poly1d(parameter)  # deg
        aa = ''  #   
        for i in range(deg + 1):
            bb = round(parameter[i], 3)
            if bb > 0:
                if i == 0:
                    bb = str(bb)
                else:
                    bb = '+' + str(bb)
            else:
                bb = str(bb)
            if deg == i:
                aa = aa + bb
            else:
                if deg - i == 1:
                    aa = aa + bb + 'x'
                else:
                    aa = aa + bb + 'x' + '$^' + str(deg - i) + '$'  #   
        fig, ax = plt.subplots()
        ax.plot(x, p(x), color='r')  # 
        ax.scatter(x, y)  # 

        # plt.text(-1,0,aa,fontdict={'size':'10','color':'b'})
        plt.legend(
            [aa + r' (R$^2: $' + str(round(r2_score(y, p(x)), 2)) + ')', 'Data points'],
            fontsize=15)
        plt.xlabel(r'Temperature ($^{\circ}C$)', size=20)
        plt.ylabel(r'Charging loads (MWh)', size=20)
        ax.tick_params(axis='both', labelsize=20)
        plt.show()
        if save_path == 1:
            fig.savefig('./results_ChargeModel/relationship_temp_demand_ChargeModel.pdf'
                        , bbox_inches='tight', pad_inches=0, dpi=600)
        else:
            fig.savefig('./results_ChargeModel/relationship_temp_demand_EVI.pdf'
                        , bbox_inches='tight', pad_inches=0, dpi=600)
        return parameter

    sorted_index = np.argsort(temperatures)
    temperatures_plot = temperatures[sorted_index]
    Days_T_S_load_ChargeModel_plot = Days_T_S_load_ChargeModel.sum(-1).sum(-1) / 1000
    Days_T_S_load_ChargeModel_plot = Days_T_S_load_ChargeModel_plot[sorted_index]
    # Days_T_S_load_ChargeModel_plot = Days_T_S_load_ChargeModel_plot.reshape((-1, 2)).sum(-1)/2
    # temperatures_plot = temperatures.reshape((-1, 2)).sum(-1)/2
    p1 = Curve_Fitting(temperatures_plot[:], Days_T_S_load_ChargeModel_plot[:], 2, save_path=1)
    print('min of ModelCharge', -p1[1] / (2 * p1[0]))
    EVI_temperatures = np.array([-4, 14, 32, 50, 68, 86, 104])
    EVI_temperatures = (5 / 9 * (EVI_temperatures - 32))  # from F to C
    p2 = Curve_Fitting(EVI_temperatures, (EVI_load.sum(-1) / 4), 2, save_path=2)
    print('min of EVI', -p2[1] / (2 * p2[0]))




def effi():
    mpl.rcParams['font.size'] = 16
    effi_matrix = np.array([[2.03, 1.93, 1.86, 1.78, 1.67, 1.54, 1.41, 1.32, 1.29, 1.36, 1.53, 1.80, 2.13],
                            [1.77, 1.68, 1.62, 1.55, 1.46, 1.53, 1.23, 1.15, 1.13, 1.19, 1.34, 1.57, 1.86],
                            [1.63, 1.55, 1.49, 1.43, 1.34, 1.24, 1.14, 1.06, 1.04, 1.09, 1.23, 1.45, 1.71],
                            [1.46, 1.39, 1.34, 1.28, 1.21, 1.11, 1.02, 0.95, 0.93, 0.98, 1.10, 1.30, 1.53],
                            [1.35, 1.28, 1.23, 1.18, 1.11, 1.02, 0.94, 0.88, 0.86, 0.90, 1.02, 1.20, 1.41],
                            [1.32, 1.25, 1.20, 1.15, 1.08, 1.00, 0.92, 0.85, 0.84, 0.88, 0.99, 1.17, 1.38],
                            [1.35, 1.28, 1.23, 1.18, 1.11, 1.02, 0.94, 0.88, 0.86, 0.90, 1.02, 1.20, 1.41],
                            [1.41, 1.34, 1.29, 1.24, 1.16, 1.07, 0.98, 0.92, 0.90, 0.94, 1.06, 1.25, 1.47],
                            [1.47, 1.39, 1.34, 1.29, 1.21, 1.11, 1.02, 0.95, 0.93, 0.98, 1.11, 1.30, 1.54],
                            [1.55, 1.47, 1.42, 1.36, 1.28, 1.18, 1.08, 1.01, 0.99, 1.04, 1.17, 1.38, 1.63],
                            [1.64, 1.56, 1.50, 1.44, 1.35, 1.25, 1.14, 1.07, 1.04, 1.10, 1.24, 1.46, 1.72],
                            [1.68, 1.59, 1.54, 1.47, 1.39, 1.28, 1.17, 1.09, 1.07, 1.13, 1.27, 1.49, 1.76],
                            [1.82, 1.72, 1.66, 1.59, 1.50, 1.38, 1.26, 1.18, 1.15, 1.21, 1.37, 1.61, 1.90]])
    temperature_seq = np.array([-20, -15, -10, -5, 0, 5, 10, 15, 20, 25, 30, 35, 40])  # C
    speed_seq = np.array(
        [2.5, 7.5, 12.5, 17.5, 22.5, 27.5, 32.5, 37.5, 42.5, 47.5, 52.5, 57.5, 62.5]) * 1.609344  # mph -> km per hour
    # 
    temperature = temperature_seq
    velocity = speed_seq
    temperature, velocity = np.meshgrid(temperature, velocity)
    efficiency = effi_matrix  # 

    # 
    fig = plt.figure()
    ax = fig.add_subplot(111, projection='3d')

    # 
    surf = ax.plot_surface(temperature, velocity, efficiency, cmap='cool')

    # 
    colorbar = fig.colorbar(surf)

    # 
    ax.set_xlabel('Temperature ($^{\circ}C$)')
    ax.set_ylabel('Velocity (km/h)')
    # ax.set_zlabel('Efficiency (%)')
    ax.set_zlabel('Relative discharge rate')

    ax.view_init(elev=30, azim=45)  # 
    # 
    plt.show()
    fig.savefig('./results_ChargeModel/effi.pdf'
                , bbox_inches='tight', pad_inches=0.3, dpi=600)
    mpl.rcParams['font.size'] = 12